@page "/forgot-password"
@using MudBlazor
@inject MyJournal.Services.AuthService AuthService
@inject MyJournal.Services.OTPService OTPService
@inject MyJournal.Services.EmailService EmailService
@inject NavigationManager NavManager

<MudGrid Justify="Justify.Center" Style="min-height: 100vh;" AlignItems="AlignItems.Center">
    <MudItem xs="12" sm="6" md="4">
        <MudPaper Class="pa-6" Elevation="6">

            <MudText Typo="Typo.h5" Align="Align.Center" Class="mb-4">
                Forgot Password
            </MudText>

            <MudText Typo="Typo.body2" Align="Align.Center" Class="mb-6" Color="Color.Default">
                Enter your email to receive a password reset code
            </MudText>

            <MudForm @ref="_form" Spacing="4">

                <MudTextField T="string"
                              Label="Email"
                              @bind-Value="_email"
                              InputType="InputType.Email"
                              Required="true"
                              RequiredError="Email is required"
                              Disabled="@_emailSent" />

                @if (!_emailSent)
                {
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Primary"
                               FullWidth="true"
                               Class="mt-4"
                               Disabled="@_isBusy"
                               OnClick="HandleSendOTP">
                        @if (_isBusy)
                        {
                            <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                            <MudText Class="ml-2">Sending...</MudText>
                        }
                        else
                        {
                            <span>Send Reset Code</span>
                        }
                    </MudButton>
                }

                @if (_emailSent)
                {
                    <MudAlert Severity="Severity.Success" Variant="Variant.Filled" Class="mt-4">
                        Reset code sent! Check your email and proceed to the next step.
                    </MudAlert>

                    <MudButton Variant="Variant.Filled"
                               Color="Color.Primary"
                               FullWidth="true"
                               Class="mt-4"
                               OnClick="@(() => NavManager.NavigateTo("/reset-password"))">
                        Continue to Reset Password
                    </MudButton>
                }

                @if (!string.IsNullOrEmpty(_errorMessage))
                {
                    <MudAlert Severity="Severity.Error" Variant="Variant.Filled" Class="mt-4">
                        @_errorMessage
                    </MudAlert>
                }

                <MudButton Variant="Variant.Text"
                           Color="Color.Primary"
                           FullWidth="true"
                           Class="mt-2"
                           OnClick="@(() => NavManager.NavigateTo("/login"))">
                    Back to Login
                </MudButton>

            </MudForm>

        </MudPaper>
    </MudItem>
</MudGrid>
